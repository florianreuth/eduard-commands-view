<!--
This project is licensed under the MIT License.
See the LICENSE file in the project root for details.

Copyright (c) 2024-2026 Florian Reuth <git@florianreuth.de>
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eduard bot commands - ViaVersion support</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1e1e1e;
            color: #ffffff;
        }

        .command-section {
            border: 1px solid #444;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #2e2e2e;
            display: none;
        }

        .command-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #ffcc00;
        }

        .message {
            margin-bottom: 10px;
            color: #ffffff;
        }

        pre {
            background-color: #3e3e2e;
            padding: 10px;
            overflow-x: auto;
            color: #ffffff;
        }

        code {
            background-color: #3e3e2e;
            padding: 2px 4px;
            color: #ffffff;
        }

        a {
            color: #00aaff;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .search-container {
            margin-top: 10px;
            margin-bottom: 20px;
            background-color: #333;
            padding: 10px;
            border-radius: 5px;
            display: flex;
            align-items: center;
        }

        #searchInput {
            flex: 1;
            border: none;
            background-color: #444;
            color: #ffffff;
            padding: 8px;
            border-radius: 3px;
        }

        #searchButton {
            background-color: #555;
            color: #ffffff;
            border: none;
            padding: 8px 15px;
            cursor: pointer;
            border-radius: 3px;
        }

        #searchButton:hover {
            background-color: #666;
        }

        .loading {
            font-size: 16px;
            font-weight: bold;
            color: #ffffff;
        }

        .copyright {
            font-size: 12px;
            margin-top: 10px;
        }
    </style>
</head>
<body>

<h1>Eduard bot commands - ViaVersion support</h1>

<div class="copyright">
    This page is built for Moderators and Triage members on the ViaVersion discord server to view all available commands for the Eduard bot.
</div>

<div class="search-container">
    <input type="text" id="searchInput" placeholder="Search for commands..." oninput="searchCommands()">
</div>

<div id="loadingIndicator" class="loading">Loading...</div>
<div id="content"></div>

<script>
    // Function to fetch JSON data from URL
    function fetchJSON(url) {
        return new Promise((resolve, reject) => {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', url, true);
            xhr.onload = () => {
                if (xhr.status >= 200 && xhr.status < 300) {
                    resolve(JSON.parse(xhr.responseText));
                } else {
                    reject(xhr.statusText);
                }
            };
            xhr.onerror = () => reject(xhr.statusText);
            xhr.send();
        });
    }

    function parseDiscordMarkdown(text) {
        if (!text) return '';

        // Handle markdown patterns with links
        let markdownHandled = false;

        text = text.replace(/\[([^\]]+)]\((https?:\/\/[^\s)]+)\)/g, function (match, text, url) {
            markdownHandled = true;
            return `<a href="${url}" target="_blank">${text}</a>`;
        });

        if (!markdownHandled) {
            text = text.replace(/\[([^\]]+)]\(<(https?:\/\/[^\s)]+)>\)/g, function (match, text, url) {
                markdownHandled = true;
                return `<a href="${url}" target="_blank">${text}</a>`;
            });
        }

        if (!markdownHandled) {
            text = text.replace(/<(https?:\/\/[^\s>]+)>/g, function (match, url) {
                markdownHandled = true;
                return `<a href="${url}" target="_blank">${url}</a>`;
            });
        }

        if (!markdownHandled) {
            // Replace normal URLs with <a> tags or image tags if ends with .png
            text = text.replace(/(https?:\/\/[^\s]+)/g, function (url) {
                if (url.toLowerCase().endsWith('.png')) {
                    return `<img src="${url}" alt="Image" style="max-width: 100%; height: auto; max-height: 300px;">`;
                } else {
                    return `<a href="${url}" target="_blank">${url}</a>`;
                }
            });
        }

        // Bold
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

        // Italics
        text = text.replace(/(?<!\*)\*(?!\*)(.*?)\*(?!\*)/g, '<em>$1</em>');
        text = text.replace(/_(.*?)_/g, '<em>$1</em>');

        // Underline
        text = text.replace(/__(.*?)__/g, '<u>$1</u>');

        // Strikethrough
        text = text.replace(/~~(.*?)~~/g, '<s>$1</s>');

        // Inline code
        text = text.replace(/`(.*?)`/g, '<code>$1</code>');

        // Code blocks
        text = text.replace(/```(.*?)```/gs, '<pre>$1</pre>');

        // Replace <#698284788074938388> with clickable link
        text = text.replace(/<#698284788074938388>/g, '<a href="https://discord.com/channels/316206679014244363/698284788074938388" target="_blank">Links</a>');

        // New lines
        text = text.replace(/\n/g, '<br>');

        return text;
    }

    function createContent(messages) {
        const contentDiv = document.getElementById('content');
        messages.forEach(messageObj => {
            const sectionDiv = document.createElement('div');
            sectionDiv.className = 'command-section';

            if (messageObj.commands) {
                const commandTitle = document.createElement('div');
                commandTitle.className = 'command-title';
                commandTitle.innerText = `Commands: ${messageObj.commands.join(', ')}`;
                sectionDiv.appendChild(commandTitle);
            }

            if (messageObj.command) {
                const commandTitle = document.createElement('div');
                commandTitle.className = 'command-title';
                commandTitle.innerText = `Command: ${messageObj.command}`;
                sectionDiv.appendChild(commandTitle);
            }

            if (messageObj.message) {
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message';
                messageDiv.innerHTML = parseDiscordMarkdown(messageObj.message);
                sectionDiv.appendChild(messageDiv);
            }

            if (messageObj.messages) {
                for (const [key, value] of Object.entries(messageObj.messages)) {
                    const subCommandTitle = document.createElement('div');
                    subCommandTitle.className = 'command-title';
                    subCommandTitle.innerText = `${key.charAt(0).toUpperCase() + key.slice(1)}:`;
                    sectionDiv.appendChild(subCommandTitle);

                    const subMessageDiv = document.createElement('div');
                    subMessageDiv.className = 'message';
                    subMessageDiv.innerHTML = parseDiscordMarkdown(value);
                    sectionDiv.appendChild(subMessageDiv);
                }
            }

            contentDiv.appendChild(sectionDiv);
            sectionDiv.style.display = 'block';
        });

        document.getElementById('loadingIndicator').style.display = 'none';
    }

    function searchCommands() {
        const input = document.getElementById('searchInput').value.toLowerCase();
        const sections = document.getElementsByClassName('command-section');

        Array.from(sections).forEach(section => {
            const commands = section.querySelector('.command-title').innerText.toLowerCase();
            const message = section.querySelector('.message') ? section.querySelector('.message').innerText.toLowerCase() : '';

            if (commands.includes(input) || message.includes(input)) {
                section.style.display = 'block';
            } else {
                section.style.display = 'none';
            }
        });
    }

    window.onload = async function () {
        try {
            const jsonData = await fetchJSON('https://raw.githubusercontent.com/ViaVersion/Eduard/master/messages.json');
            createContent(jsonData.messages);
        } catch (error) {
            console.error('Error fetching JSON:', error);
            document.getElementById('loadingIndicator').innerText = 'Failed to load JSON.';
        }
    };
</script>
</body>
</html>
